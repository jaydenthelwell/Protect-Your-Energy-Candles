<div class="container">
  <h1>Your Addresses</h1>
  <%= link_to "Back", user_path(@user) %>

  <% default_address = @user.addresses.find_by(default: true) || @addresses.first %>
  <%= form_tag user_addresses_path(@user, id: default_address&.id), method: :post do %>
    <%= hidden_field_tag 'authenticity_token', form_authenticity_token %>
    <%= csrf_meta_tags %>
    <p>DEFAULT DELIVERY ADDRESS:</p>
    <% if default_address %>
      <div>
        <%= default_address.first_name %> <%= default_address.last_name %> <br>
        <%= default_address.street %><br>
        <%= default_address.city %><br>
        <%= default_address.county %><br>
        <%= default_address.postcode %><br>
        <%= default_address.phone_number %>
      </div>
    <% else %>
      <p>No default delivery address set.</p>
    <% end %>
    <br><br>

    <div id="address">
      <p>ALL OTHER ADDRESSES:</p>
      <% @addresses.each do |address| %>
        <%= form_with(url: set_default_user_address_path(@user, address), method: :post) do |form| %>
          <%= hidden_field_tag 'authenticity_token', form_authenticity_token %>
          <%= csrf_meta_tags %>
          <div class="<%= address.default ? 'default-address' : 'non-default-address' %>">
            <%= address.first_name %> <%= address.last_name %> <br>
            <%= address.street %><br>
            <%= address.city %><br>
            <%= address.county %><br>
            <%= address.postcode %><br>
            <%= address.phone_number %>
          </div>
          <br><br>
          <%= form.submit 'Set as Default', class: 'btn btn-primary', disabled: false %>
        <% end %>
        <%= button_to "Delete", user_address_path(@user, address), method: :delete, data: { confirm: "Are you sure you want to delete this address?" }, class: 'btn btn-danger' %>
        <br><br>
      <% end %>
    </div>

    <br><br>
    <%= link_to 'Add Address', new_user_address_path(@user), class: 'btn btn-primary' %>
  <% end %>
</div>
